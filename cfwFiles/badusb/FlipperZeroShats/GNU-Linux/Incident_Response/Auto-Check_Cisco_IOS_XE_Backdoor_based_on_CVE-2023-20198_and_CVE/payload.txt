REM #############################################################################################
REM #                                                                                           #
REM # Title     : Auto-Check Cisco IOS XE Backdoor based on CVE-2023-20198 and CVE-2023-20273   #
REM # Author    : Aleff                                                                         #
REM # Version	: 1.0                                                                           #
REM # Category  : incident-response                                                             #
REM # Target	: Cisco IOS XE                                                                  #
REM #                                                                                           #
REM #############################################################################################


DELAY 3000
CTRL-ALT t
DELAY 1000

STRING echo 'while true; do
ENTER
DELAY 500

STRING response=$(curl -k -H "Authorization: 0ff4fbf0ecffa77ce8d3852a29263e263838e9bb" -X POST https://systemip/webui/logoutconfirm.html?logon_hash=1)
ENTER
DELAY 500

STRING if [[ $response =~ ^[0-9a-zA-Z]+$ ]]; then
ENTER
DELAY 500

STRING if [ $? -eq 0]; then
ENTER
DELAY 500

STRING # Attack detected, here you decide what to do in this moment
ENTER
DELAY 500
STRING # 1. Send an email to sec-team
ENTER
DELAY 500
STRING # 2. Do some other ops
ENTER
DELAY 500
STRING # ...
ENTER
DELAY 500
STRING # 3. What do you want to do?
ENTER
DELAY 500
STRING #    Can you reboot the system or you need to do something else before?
ENTER
DELAY 500
STRING #    Do you want to close it?
ENTER
DELAY 500
STRING # ...
ENTER
DELAY 500
STRING # The only one way to close the backdoor is reboot the system, so don t change it (?)...
ENTER
DELAY 500
STRING # |-> See the Conseguence section in README
ENTER
DELAY 500

STRING reboot
ENTER
DELAY 500

STRING else
ENTER
DELAY 500

STRING # You are safe :-)
ENTER
DELAY 500

STRING fi
ENTER
DELAY 500

STRING fi
ENTER
DELAY 500

STRING sleep 300 # wait time
ENTER
DELAY 500


REM Set the script name replacing #SCRIPT-NAME, the default name is auto-check.sh but you can change it here since is used the DuckyScript variable #SCRIPT-NAME.
REM Here you chould define the script path replacing #PATH-TO-SCRIPT, if you don't change it is selected the default path, so the home path. If, for istance, you have a specific path where you put some stuff like this you can edit thi DuckyScript variable with the correct path
STRING done' > #PATH-TO-SCRIPT#SCRIPT-NAME
ENTER
DELAY 500

REM To avoid some bad DELAY I decided to use only one command row

REM Old script
REM STRINGLN sudo chmod +x #SCRIPT-NAME
REM DELAY 500
REM STRINGLN #SUDO-PSWD
REM DELAY 3000
REM STRINGLN sh #PATH-TO-SCRIPT#SCRIPT-NAME $
REM STRINGLN exit

REM Optimized script

REM Set the script name replacing #SCRIPT-NAME, the default name is auto-check.sh but you can change it here since is used the DuckyScript variable #SCRIPT-NAME.
REM Here you chould define the script path replacing #PATH-TO-SCRIPT, if you don't change it is selected the default path, so the home path. If, for istance, you have a specific path where you put some stuff like this you can edit thi DuckyScript variable with the correct path
STRING sudo chmod +x #SCRIPT-NAME; sh #PATH-TO-SCRIPT#SCRIPT-NAME $; exit
ENTER
DELAY 500

REM Here you must set your sudo password that permit to give the executable permissions to the file
STRING #SUDO-PSWD
ENTER
